Namespaces:
  =: io.murano.resources
  std: io.murano
  sys: io.murano.system


Name: AWSInstance

Extends: Instance

Properties:
  name:
    Contract: $.string().notNull()
  image:
    Contract: $.string().notNull()
  agent:
    Contract: $.class(sys:SSHAgent)
    Usage: Runtime
  ipAddresses:
    Contract: [$.string()]
    Usage: Out
  assignFloatingIp:
    Contract: $.bool().notNull()
    Default: false
  floatingIpAddress:
    Contract: $.string()
    Usage: Out

Methods:
  initialize:
    Body:
      - $.environment: $.find(std:Environment).require()
      - $.resources: new(sys:Resources)
      - $.instanceTemplate: {}
      - $._floatingIpOutputName: null
      - $.node: null
      - If: $.getAttr(cloudid, false)
        Then:
            $cloud_id: $.cloudid
        Else:
            $cloud_id: $.environment.defaultCloud
      - $.cloud: new(sys:Cloud,id=>$cloud_id)
      - $.agent: new(sys:SSHAgent, host => $,cloud=>$.cloud)

  deploy:
    Arguments:
      plan:
        Contract: {}
    Body:
      - $.driver: new(sys:AWSBinding,$.cloud.credentials)
      - $.node: $.driver.createnode($.image,$.flavor,$.name)
      - $.ipAddresses: $.driver.getpublicips($.node)
      - $.agent.setnode($.node)
  destroy:
    Body:
      - $.driver: new(sys:AWSBinding)
      - $.driver.destroynode($.node)
      - $.node: null

